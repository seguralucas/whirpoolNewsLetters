package whirlpool.newsletter;


import com.jcraft.jsch.Channel;
import com.jcraft.jsch.ChannelSftp;
import com.jcraft.jsch.JSch;
import com.jcraft.jsch.Session;

import whirlpool.newsletter.configuracion.SFTPPropiedades;


public class SFTP {
	
	private SFTPPropiedades sftpPropiedades;
	
	
	public SFTP(SFTPPropiedades sftpPropiedades) {
		this.sftpPropiedades=sftpPropiedades;
	}
	


	public void transferirFichero(String pathInput, String pathOutput) throws Exception {
    try {
    JSch jsch = new JSch();
    jsch.addIdentity(sftpPropiedades.getKeyFile());
    Session session = jsch.getSession(sftpPropiedades.getUser(), sftpPropiedades.getHost(), sftpPropiedades.getPuerto());
    java.util.Properties config = new java.util.Properties(); 
    config.put("StrictHostKeyChecking", "no");
    session.setConfig(config);
    session.connect();
    Channel channel = session.openChannel("sftp");
    channel.setInputStream(System.in);
    channel.setOutputStream(System.out);
    channel.connect();
    ChannelSftp c = (ChannelSftp) channel;
    String fileName = pathInput;
    System.out.println(fileName);
    System.out.println(pathOutput);
    c.put(fileName, pathOutput);
    c.exit();
    session.disconnect();

	} catch (Exception e) {
	    e.printStackTrace();
	    WritterHelper.getInstance().escribirError("errorSFTP.log", "Error al transferir el archivo "+pathOutput+" por sftp");
	    throw e;
	}
	}


public SFTPPropiedades getSftpPropiedades() {
	return sftpPropiedades;
}



public void setSftpPropiedades(SFTPPropiedades sftpPropiedades) {
	this.sftpPropiedades = sftpPropiedades;
}

}
